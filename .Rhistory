SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 1000, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
# mif_logLik$eps <- unlist(lapply(m2, function(x) x@shared['epsilon']), use.names = FALSE)
#
# mif_logLik %>%
#   arrange(-logLik) %>%
#   slice_head(n = 1) %>%
#   pull(which) -> best_m
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = TRUE)
# best_coef <- coef(m2[[best_m]])
# best_params[grepl("foi", names(best_params))] <- 0
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
coef(mod3)[grepl("B0", names(coef(mod3)))] <- rep(0.024, 10)
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
coef(mod3)
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = TRUE)
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
# mif_logLik$eps <- unlist(lapply(m2, function(x) x@shared['epsilon']), use.names = FALSE)
#
# mif_logLik %>%
#   arrange(-logLik) %>%
#   slice_head(n = 1) %>%
#   pull(which) -> best_m
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = TRUE)
mod3
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
ggplot() +
geom_line(data = real_data, aes(x = time, y = mean), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = q50), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = q05, ymax = q95),
alpha = 0.5) +
facet_wrap(~dep, scales = 'free_y') +
theme_bw()
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = FALSE)
names(coef(mod3))
coef(mod3)[grepl("B0", names(coef(mod3)))]
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
ggplot() +
geom_line(data = real_data, aes(x = time, y = mean), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = q50), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = q05, ymax = q95),
alpha = 0.5) +
facet_wrap(~dep, scales = 'free_y') +
theme_bw()
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
# mif_logLik$eps <- unlist(lapply(m2, function(x) x@shared['epsilon']), use.names = FALSE)
#
# mif_logLik %>%
#   arrange(-logLik) %>%
#   slice_head(n = 1) %>%
#   pull(which) -> best_m
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = FALSE)
# best_coef <- coef(m2[[best_m]])
# best_params[grepl("foi", names(best_params))] <- 0
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
# Simulate ----------------------------------------------------------------
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
# mif_logLik$eps <- unlist(lapply(m2, function(x) x@shared['epsilon']), use.names = FALSE)
#
# mif_logLik %>%
#   arrange(-logLik) %>%
#   slice_head(n = 1) %>%
#   pull(which) -> best_m
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = FALSE)
# best_coef <- coef(m2[[best_m]])
# best_params[grepl("foi", names(best_params))] <- 0
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
# Simulate ----------------------------------------------------------------
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
mod3 <- haiti3_panel(start_time = "2010-10-23",
B0 = FALSE)
mod3 <- haiti3_panel(start_time = "2010-10-23")
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
library(tidyverse)
library(pomp)
library(panelPomp)
library(haitipkg)
library(foreach)
library(doParallel)
library(doRNG)
# load('output/reporting_rate_profile2.rda')
# load('output/reporting_rate_profile_PF2.rda')
# load('output/all_time_local_unit.rda')
# load('output/all_time_local_unit_PF.rda')
load('output/best_params_no_trend.rda')
# mif_logLik$eps <- unlist(lapply(m2, function(x) x@shared['epsilon']), use.names = FALSE)
#
# mif_logLik %>%
#   arrange(-logLik) %>%
#   slice_head(n = 1) %>%
#   pull(which) -> best_m
mod3 <- haiti3_panel(start_time = "2010-10-23")
# best_coef <- coef(m2[[best_m]])
# best_params[grepl("foi", names(best_params))] <- 0
# coef(mod3) <- best_params
coef(mod3)[!grepl("B0", names(coef(mod3)))] <- best_params
departements <-
c(
'Artibonite',
'Centre',
'Grande_Anse',
'Nippes',
'Nord',
'Nord-Est',
'Nord-Ouest',
'Ouest',
'Sud',
'Sud-Est'
)
# Simulate ----------------------------------------------------------------
registerDoParallel(5)
registerDoRNG(5317865)
pomp_shared <- mod3@shared
foreach(dep=departements, .combine = rbind) %dopar% {
SIRB <- unitobjects(mod3)[[dep]]
# shared <- SIRB_panel@shared
specific <- mod3@specific[, dep]
pomp::simulate(SIRB, params = c(pomp_shared, specific),
nsim = 200, format = 'data.frame',
include.data = TRUE) -> sims
sims$dep <- dep
sims
} -> all_sims
quantiles <- all_sims %>%
mutate(isdata = .id == 'data') %>%
# filter(!isdata) %>%
group_by(isdata, dep, time) %>%
summarise(
q05 = quantile(cases, 0.025, na.rm = T),
mean = mean(cases, na.rm = T),
q50 = quantile(cases, 0.5, na.rm = T),
q95 = quantile(cases, 0.975, na.rm = T)
)
real_data <- quantiles %>%
filter(isdata)
sim_data <- quantiles %>%
filter(!isdata)
ggplot() +
geom_line(data = real_data, aes(x = time, y = log(mean + 1)), col = 'red') +
geom_line(data = sim_data, aes(x = time, y = log(q50 + 1)), col = 'blue') +
geom_ribbon(data = sim_data, aes(x = time, ymin = log(q05 + 1), ymax = log(q95 + 1)),
alpha = 0.5) +
facet_wrap(~dep) +
theme_bw()
